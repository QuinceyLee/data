(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0db4af"],{"6ef0":function(e,t,l){"use strict";l.r(t);var a=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("el-container",{staticStyle:{height:"800px",border:"1px solid #eee"}},[l("el-main",[l("el-card",{staticClass:"box-card"},[l("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[l("span",[e._v(" 输出目标管理")])]),l("el-button",{attrs:{type:"primary",icon:"el-icon-help"},on:{click:function(t){e.status.createDialogVisible=!0}}},[e._v(" 新 建 ")]),l("el-button",{attrs:{type:"success",icon:"el-icon-refresh"},on:{click:e.refreshList}},[e._v(" 刷 新 ")]),l("el-dialog",{attrs:{top:"10vh",width:"1100",title:"新建目标","show-close":!1,"close-on-click-modal":!1,visible:e.status.createDialogVisible},on:{"update:visible":function(t){return e.$set(e.status,"createDialogVisible",t)},closed:e.createDialogClosed}},[l("el-form",{ref:"createFormRef",attrs:{model:e.createForm,rules:e.createFormRules,"label-width":"78px"}},[l("el-form-item",{attrs:{label:"目标名称",prop:"name"}},[l("el-input",{attrs:{placeholder:"输出目标名称",maxlength:"20",clearable:""},model:{value:e.createForm.name,callback:function(t){e.$set(e.createForm,"name",t)},expression:"createForm.name"}})],1),l("el-form-item",{attrs:{label:"目标类型",prop:"type"}},[l("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"输出目标类型",filterable:"",clearable:""},on:{change:e.onSelectChange},model:{value:e.createForm.type,callback:function(t){e.$set(e.createForm,"type",t)},expression:"createForm.type"}},[l("el-option",{attrs:{label:"MQTT 桥接",value:"MQTT"}}),l("el-option",{attrs:{label:"MQTT 遥测",value:"MQTT_TELEMETRY_TARGET"}}),l("el-option",{attrs:{label:"MONGO 单节点",value:"MONGO_SINGLE"}}),l("el-option",{attrs:{label:"TdEngine",value:"TDENGINE"}})],1)],1),e.status.configFormVisible?l("el-form-item",{attrs:{label:"目标配置"}},[l("dynamic-form",{ref:"dynamicFormRef",attrs:{options:e.jsonConfig,protocol:e.protocol},on:{onChanged:function(t){return e.dynamicFormChanged(t)}}})],1):e._e(),l("el-form-item",{attrs:{label:"备注信息",prop:"description"}},[l("el-input",{attrs:{autocomplete:"off",placeholder:"备注信息",maxlength:"50",clearable:""},model:{value:e.createForm.description,callback:function(t){e.$set(e.createForm,"description",t)},expression:"createForm.description"}})],1)],1),l("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){e.status.createDialogVisible=!1}}},[e._v(" 取 消 ")]),l("el-button",{attrs:{type:"primary",loading:e.status.createLoading},on:{click:e.createOutEnd}},[e._v(" 提 交 ")])],1)],1)],1),l("el-table",{staticStyle:{width:"100%","margin-top":"10px"},attrs:{data:e.outendsTableData,border:""}},[l("el-table-column",{attrs:{prop:"uuid",label:"UUID",width:"360px"}}),l("el-table-column",{attrs:{prop:"type",label:"类型",width:"240px",filters:[{text:"MQTT 协议桥接",value:"MQTT"},{text:"MQTT 遥测",value:"MQTT_TELEMETRY_TARGET"},{text:"MongoDb 存储",value:"MONGO_SINGLE"},{text:"TdEngine",value:"TDENGINE"}],"filter-method":e.filterType}}),l("el-table-column",{attrs:{prop:"name",label:"名称"}}),l("el-table-column",{attrs:{prop:"description",label:"信息"}}),l("el-table-column",{attrs:{prop:"state",label:"状态",filters:[{text:"正常",value:1},{text:"异常",value:0}],"filter-method":e.filterState,width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.state?l("el-tag",{attrs:{type:"success"}},[e._v("正常")]):l("el-tag",{attrs:{type:"danger"}},[e._v("异常")])]}}])}),l("el-table-column",{attrs:{fixed:"right",label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(l){return e.details(t.row)}}},[e._v(" 详情 ")]),l("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(l){return e.removeOutEnd(t.row)}}},[e._v(" 删除 ")])]}}])})],1),l("el-dialog",{attrs:{title:"输出目标详情",visible:e.status.detailDialogVisible,width:"800px"},on:{"update:visible":function(t){return e.$set(e.status,"detailDialogVisible",t)}}},[l("el-descriptions",{attrs:{border:"",column:1,"label-style":e.LS}},[l("el-descriptions-item",{attrs:{label:"type"}},[l("el-tag",{attrs:{size:"small"}},[e._v(e._s(e.outEndDetail.type))])],1),l("el-descriptions-item",{attrs:{label:"name"}},[e._v(" "+e._s(e.outEndDetail.name)+" ")]),e._l(e.outEndDetail.config,(function(t,a){return l("el-descriptions-item",{key:a,attrs:{label:a}},[e._v(" "+e._s(t)+" ")])})),l("el-descriptions-item",{attrs:{label:"description"}},[e._v(" "+e._s(e.outEndDetail.description)+" ")])],2),l("span",{attrs:{slot:"footer"},slot:"footer"},[l("el-button",{attrs:{type:"primary"},on:{click:function(t){e.status.detailDialogVisible=!1}}},[e._v(" 确 定 ")])],1)],1)],1)],1)},r=[],i=(l("e9c4"),l("b64b"),l("b775"));function o(){return Object(i["a"])({url:"outends",method:"get"})}function n(e){return Object(i["a"])({url:"outends",method:"post",data:e})}function s(e){return Object(i["a"])({method:"delete",url:"outends?uuid="+e})}var u=l("5c96"),c={MQTT:[{type:"el-input-text",name:"host",label:"服务地址",value:"127.0.0.1",required:!0,placeholder:"127.0.0.1"},{type:"el-input-number",name:"port",label:"服务端口",value:"1883",required:!0,placeholder:"1883"},{type:"el-input-text",name:"dataTopic",label:"订阅Topic",value:"rulex-data-1",required:!0,placeholder:"rulex-data-1"},{type:"el-input-text",name:"clientId",label:"客户端ID",value:"rulex-1",required:!0,placeholder:"rulex-1"},{type:"el-input-text",name:"username",label:"MQTT用户名",value:"rulex-1",required:!0,placeholder:"rulex-1"},{type:"el-input-text",name:"password",label:"MQTT密码",value:"rulex-1",required:!0,placeholder:"rulex-1"}],MQTT_TELEMETRY_TARGET:[{type:"el-input-text",name:"host",label:"服务地址",value:"127.0.0.1",required:!0,placeholder:"127.0.0.1"},{type:"el-input-number",name:"port",label:"服务端口",value:"1883",required:!0,placeholder:"1883"},{type:"el-input-text",name:"s2cTopic",label:"订阅Topic",value:"rulex-client-1",required:!0,placeholder:"rulex-client-1"},{type:"el-input-text",name:"toplogyTopic",label:"拓扑同步Topic",value:"rulex-toplogy-1",required:!0,placeholder:"rulex-toplogy-1"},{type:"el-input-text",name:"logTopic",label:"日志同步Topic",value:"rulex-logTopic-1",required:!0,placeholder:"rulex-logTopic-1"},{type:"el-input-text",name:"dataTopic",label:"自定义数据上传Topic",value:"rulex-data-1",required:!0,placeholder:"rulex-data-1"},{type:"el-input-text",name:"stateTopic",label:"状态同步Topic",value:"rulex-state-1",required:!0,placeholder:"rulex-state-1"},{type:"el-input-text",name:"clientId",label:"客户端ID",value:"rulex-1",required:!0,placeholder:"rulex-1"},{type:"el-input-text",name:"username",label:"MQTT用户名",value:"rulex-1",required:!0,placeholder:"rulex-1"},{type:"el-input-text",name:"password",label:"MQTT密码",value:"rulex-1",required:!0,placeholder:"rulex-1"}],MONGO_SINGLE:[{type:"el-input-text",name:"mongoUrl",label:"MongoDB URL",value:"mongodb://user:password@127.0.0.1:27017/?authSource=admin",required:!0,placeholder:"mongodb://user:password@127.0.0.1:27017/?authSource=admin"},{type:"el-input-text",name:"database",label:"MongoDB数据库",value:"rulex",required:!0,placeholder:"rulex"},{type:"el-input-text",name:"collection",label:"MongoDB集合",value:"rulex_data",required:!0,placeholder:"rulex_data"}],TDENGINE:[{type:"el-input-text",name:"fqdn",label:"服务地址",value:"127.0.0.1",required:!0,placeholder:"127.0.0.1"},{type:"el-input-number",name:"port",label:"服务端口",value:4400,required:!0,placeholder:"4400"},{type:"el-input-text",name:"username",label:"用户",value:"root",required:!0,placeholder:"root"},{type:"el-input-text",name:"password",label:"密码",value:"taosdata",required:!0,placeholder:"taosdata"},{type:"el-input-text",name:"dbName",label:"数据库名",value:"device",required:!0,placeholder:"device"},{type:"el-input-text",name:"createDbSql",label:"建库SQL",value:"CREATE DATABASE IF NOT EXISTS device UPDATE 0;",required:!0,placeholder:"CREATE DATABASE IF NOT EXISTS device UPDATE 0;"},{type:"el-input-text",name:"createTableSql",label:"建表SQL",value:"CREATE TABLE IF NOT EXISTS meter (ts TIMESTAMP, current FLOAT, valtage FLOAT);",required:!0,placeholder:"CREATE TABLE IF NOT EXISTS meter (ts TIMESTAMP, current FLOAT, valtage FLOAT);"},{type:"el-input-text",name:"insertSql",label:"插入SQL",value:"INSERT INTO meter VALUES (NOW, %v, %v);",required:!0,placeholder:"INSERT INTO meter VALUES (NOW, %v, %v);"}]},p=c,d=l("2a06"),m={name:"OutEnd",components:{DynamicForm:d["a"]},data:function(){return{LS:{width:"200px"},createForm:{type:"",name:"",description:"",config:{}},createFormRules:{type:[{required:!0,message:"输入类型",trigger:["blur","change"]}],name:[{required:!0,message:"输入名称",trigger:["blur","change"]}],description:[{required:!0,message:"输入描述",trigger:["blur","change"]}]},protocol:"",outEndDetail:{},outendsTableData:[],status:{createLoading:!1,createDialogVisible:!1,detailDialogVisible:!1,configFormVisible:!1}}},created:function(){this.getList()},methods:{getList:function(){var e=this;o().then((function(t){e.outendsTableData=t.data}))},onSelectChange:function(e){this.protocol=e,this.jsonConfig=p[e],this.status.configFormVisible=!0},createDialogClosed:function(){this.status.configFormVisible=!1,this.status.createLoading=!1,this.$refs.createFormRef.resetFields(),this.createForm=this.$options.data().createForm},dynamicFormChanged:function(e){this.createForm.config=JSON.parse(JSON.stringify(e))},createOutEnd:function(){var e=this;this.$refs.createFormRef.validate((function(t){if(t){var l=e.$refs.dynamicFormRef.validateForm();if(l){var a=JSON.parse(JSON.stringify(e.createForm));return delete a.config.moreRegisterParams,e.status.createLoading=!0,n(a).then((function(t){Object(u["Message"])({message:"创建成功",type:"success",duration:5e3}),e.getList(),e.status.createDialogVisible=!1})).catch((function(){e.status.createLoading=!1})),!0}return!1}return!1}))},filterType:function(e,t){return t.type===e},filterState:function(e,t){return t.state===e},refreshList:function(){this.getList(),Object(u["Message"])({message:"刷新成功",type:"success",duration:5e3})},details:function(e){this.outEndDetail=e,this.status.detailDialogVisible=!0},removeOutEnd:function(e){var t=this;s(e.uuid).then((function(e){Object(u["Message"])({message:e.msg,type:"success",duration:5e3}),t.getList()}))},isEmpty:function(e){return!("number"===typeof e&&!isNaN(e))&&(!e||Object.keys(e).length<1)}}},b=m,f=l("2877"),h=Object(f["a"])(b,a,r,!1,null,null,null);t["default"]=h.exports}}]);